[gd_scene load_steps=20 format=3 uid="uid://b35lttxkqaonm"]

[ext_resource type="Script" uid="uid://dluemmoxdkgn4" path="res://scenes/gameplay/guard/guard.gd" id="1_otknk"]
[ext_resource type="PackedScene" uid="uid://bniipnxxt8ijc" path="res://models/guard/guard.blend" id="1_s4gqi"]
[ext_resource type="Material" uid="uid://bfnjw0fneby2r" path="res://resources/materials/toon-gray.tres" id="2_4cjav"]
[ext_resource type="Material" uid="uid://bduaqv1jwtw16" path="res://resources/materials/toon-yellow.tres" id="3_2steh"]
[ext_resource type="Script" uid="uid://btae0m6xhtshu" path="res://scenes/gameplay/guard/view_drawer.gd" id="4_2steh"]
[ext_resource type="Script" uid="uid://bololiw7rlhov" path="res://scenes/gameplay/guard/detection_area.gd" id="5_6dx3q"]
[ext_resource type="Script" uid="uid://c7ly57avfuf35" path="res://scenes/gameplay/guard/guard_animator.gd" id="5_nw0ie"]
[ext_resource type="Shader" uid="uid://ufutx2t3wlr2" path="res://shaders/bar3d.gdshader" id="8_a7men"]
[ext_resource type="Texture2D" uid="uid://c4cs7faca3gaq" path="res://textures/eye/unaware.svg" id="8_plmtm"]
[ext_resource type="Texture2D" uid="uid://cxn487tgnbn5a" path="res://textures/eye/alert.svg" id="9_n2vfk"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_3ptlu"]
radius = 0.3
height = 1.2915039

[sub_resource type="SphereShape3D" id="SphereShape3D_4cjav"]
radius = 5.0

[sub_resource type="ViewportTexture" id="ViewportTexture_2steh"]
viewport_path = NodePath("DetectionArea/ViewDrawer/Sprite3D/SubViewport")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_a7men"]
render_priority = 1
shader = ExtResource("8_a7men")
shader_parameter/bar_texture = ExtResource("9_n2vfk")
shader_parameter/fill = 0.38999999128272
shader_parameter/fill_color = Color(0.9490196, 0.12156863, 0.12156863, 1)
shader_parameter/unfill_color = Color(0, 0, 0, 1)
shader_parameter/fill_reverse = false
shader_parameter/y_billboard = false

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_otknk"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_6dx3q"]
animation = &"run"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_plmtm"]
blend_point_0/node = SubResource("AnimationNodeAnimation_otknk")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("AnimationNodeAnimation_6dx3q")
blend_point_1/pos = 1.0
min_space = 0.0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_a7men"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_n2vfk"]
states/Movement/node = SubResource("AnimationNodeBlendSpace1D_plmtm")
states/Movement/position = Vector2(428, 65)
transitions = ["Start", "Movement", SubResource("AnimationNodeStateMachineTransition_a7men")]

[node name="Guard" type="CharacterBody3D" groups=["gameplay_pausable"]]
collision_layer = 4
collision_mask = 3
script = ExtResource("1_otknk")

[node name="NavigationAgent3D" type="NavigationAgent3D" parent="."]
avoidance_enabled = true
debug_enabled = true

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.64575195, 0)
shape = SubResource("CapsuleShape3D_3ptlu")

[node name="guard" parent="." instance=ExtResource("1_s4gqi")]

[node name="Skeleton3D" parent="guard/Armature" index="0"]
bones/1/position = Vector3(0, 0.5765718, -0.13840275)
bones/1/rotation = Quaternion(0.12790811, 0, 0, 0.99178606)
bones/2/rotation = Quaternion(0.14116544, 1.1914924e-07, -3.783314e-09, 0.98998606)
bones/3/rotation = Quaternion(-0.209422, -1.1914009e-07, -5.5525207e-09, 0.97782534)
bones/4/rotation = Quaternion(-0.5711275, -0.11997714, -0.11208487, 0.8042736)
bones/5/rotation = Quaternion(-0.43811038, 0.32719743, -0.46363416, 0.69716895)
bones/6/rotation = Quaternion(0.054573964, -0.0033542244, -0.43629643, 0.8981402)
bones/7/rotation = Quaternion(0.08103586, -0.21002173, -0.07685435, 0.97129685)
bones/8/rotation = Quaternion(-0.46566272, 0.016246205, 0.024509683, 0.8844737)
bones/9/rotation = Quaternion(-0.44355547, 0.0011353872, -0.0008460417, 0.8962458)
bones/10/rotation = Quaternion(-0.44057995, 0.00012227417, 1.2192417e-05, 0.89771336)
bones/11/rotation = Quaternion(-0.45525202, 0.0259934, 0.006353147, 0.88996047)
bones/12/rotation = Quaternion(-0.443555, 0.0011221565, -0.0008633667, 0.8962461)
bones/13/rotation = Quaternion(-0.44354904, 0.0014168213, 0.000101172, 0.896249)
bones/14/rotation = Quaternion(-0.44333076, 0.034111097, 0.015339907, 0.89557743)
bones/15/rotation = Quaternion(-0.45030132, 0.0022104837, -0.010324254, 0.8928142)
bones/16/rotation = Quaternion(-0.44059387, -0.001911412, 0.0025716382, 0.8977008)
bones/17/rotation = Quaternion(-0.45563877, 0.02866179, 0.009502732, 0.8896525)
bones/18/rotation = Quaternion(-0.44049132, 0.0006039923, 0.0031565106, 0.89775115)
bones/19/rotation = Quaternion(-0.44059318, -0.0019441841, 0.0025467186, 0.8977012)
bones/20/rotation = Quaternion(-0.45895, 0.45648837, -0.37671664, 0.66262203)
bones/21/rotation = Quaternion(0.024644494, -0.07398949, 0.33749834, 0.9380902)
bones/22/rotation = Quaternion(0.010886986, -0.00877155, 0.3417319, 0.93969357)
bones/23/rotation = Quaternion(-0.38897857, 0.64044213, 0.07240293, 0.6582458)
bones/24/rotation = Quaternion(-0.86125195, -0.047855973, 0.13014533, 0.48889375)
bones/25/rotation = Quaternion(0.03883742, 0.0035471073, 0.3104892, 0.9497766)
bones/26/rotation = Quaternion(-0.050536476, 0.10344547, -0.15327124, 0.98145455)
bones/27/rotation = Quaternion(-0.52253956, -0.032224145, -0.019768506, 0.85177654)
bones/28/rotation = Quaternion(-0.5139167, 1.8647969e-06, 1.1806604e-06, 0.85784006)
bones/29/rotation = Quaternion(-0.51390964, -4.1128924e-06, -2.4121612e-06, 0.85784435)
bones/30/rotation = Quaternion(-0.5158276, -0.03237859, -0.019514294, 0.85585785)
bones/31/rotation = Quaternion(-0.51391625, 1.689752e-06, 8.01133e-07, 0.85784036)
bones/32/rotation = Quaternion(-0.51391053, -3.3147903e-06, -2.2285574e-06, 0.8578438)
bones/33/rotation = Quaternion(-0.5135478, -0.03243043, -0.019428343, 0.8572278)
bones/34/rotation = Quaternion(-0.5139161, 1.456533e-06, 8.9893354e-07, 0.85784054)
bones/35/rotation = Quaternion(-0.51391095, -3.0973713e-06, -1.802539e-06, 0.85784364)
bones/36/rotation = Quaternion(-0.5038348, -0.03264772, -0.019060878, 0.86297244)
bones/37/rotation = Quaternion(-0.5139164, 1.6908748e-06, 1.1060029e-06, 0.8578403)
bones/38/rotation = Quaternion(-0.5139101, -3.7389045e-06, -2.2090912e-06, 0.857844)
bones/39/rotation = Quaternion(-0.3191992, -0.114956945, 0.23998033, 0.90956384)
bones/40/rotation = Quaternion(0.021155154, 0.07237045, -0.24740863, 0.9659731)
bones/41/rotation = Quaternion(0.0013798842, 0.005581234, -0.25224206, 0.9676471)
bones/42/rotation = Quaternion(0.6043075, -0.3671682, -0.6043076, 0.36716813)
bones/43/rotation = Quaternion(0.055106934, 0.7049561, -0.055106945, 0.7049563)
bones/45/rotation = Quaternion(0.49032605, -0.5094903, 0.49032593, 0.50949055)
bones/46/rotation = Quaternion(0.089158036, -1.5189098e-08, 1.3596473e-09, 0.9960175)
bones/47/rotation = Quaternion(0.7001976, 0.098607816, 0.7001975, 0.0986077)
bones/48/rotation = Quaternion(0.4389025, -0.5544046, 0.4389025, 0.5544048)
bones/50/rotation = Quaternion(0.4365859, 0.55623084, -0.43658584, 0.556231)
bones/51/rotation = Quaternion(0.39867017, 1.3985536e-08, -6.079654e-09, 0.9170944)
bones/52/position = Vector3(0, 0.8390558, 1.5643241)
bones/53/position = Vector3(0.15906236, 0.2310595, 0.21283965)
bones/54/position = Vector3(0.15906236, 0.48284402, 0.82830685)
bones/55/position = Vector3(0.3958918, 0.7944288, -0.5125047)
bones/56/position = Vector3(0.29804096, 0.69969904, -0.18041301)
bones/57/position = Vector3(-0.15906236, 0.27873862, -0.295906)
bones/58/position = Vector3(-0.15906236, 0.48284402, 0.82830685)
bones/59/position = Vector3(-0.38137782, 0.8051661, -0.5125047)
bones/60/position = Vector3(-0.2986835, 0.61044574, 0.179672)
bones/61/position = Vector3(0.3079713, 0.66316766, -0.3281982)
bones/61/rotation = Quaternion(0.8068435, -0.0032952235, 0.0010703492, 0.59075516)
bones/62/position = Vector3(0.011270277, 0.99846315, 0.14131132)
bones/62/rotation = Quaternion(0.6445297, -0.08370036, -0.7503328, 0.120733365)
bones/63/rotation = Quaternion(1.6201618e-08, 1.5141246e-08, -0.26169962, 0.9651494)
bones/64/rotation = Quaternion(1.1381558e-09, -5.674938e-09, -0.09595978, 0.9953852)
bones/65/rotation = Quaternion(1.7563699e-09, -6.5531154e-09, -0.095959805, 0.9953853)

[node name="BaseModel" parent="guard/Armature/Skeleton3D" index="0"]
surface_material_override/0 = ExtResource("2_4cjav")

[node name="Flashlight" parent="guard/Armature/Skeleton3D" index="1"]
surface_material_override/1 = ExtResource("3_2steh")

[node name="Glasses" parent="guard/Armature/Skeleton3D" index="2"]
surface_material_override/0 = ExtResource("3_2steh")

[node name="Tie" parent="guard/Armature/Skeleton3D" index="3"]
surface_material_override/0 = ExtResource("3_2steh")

[node name="DetectionArea" type="Area3D" parent="."]
transform = Transform3D(-4.371139e-08, 0, -1, 0, 1, 0, 1, 0, -4.371139e-08, 0, 1, 0)
collision_layer = 0
script = ExtResource("5_6dx3q")
metadata/_edit_lock_ = true

[node name="CollisionShape3D" type="CollisionShape3D" parent="DetectionArea"]
shape = SubResource("SphereShape3D_4cjav")

[node name="ViewDrawer" type="Node3D" parent="DetectionArea"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.100000024, 0)
script = ExtResource("4_2steh")
arc = 0.25
ray_count = 36

[node name="Sprite3D" type="Sprite3D" parent="DetectionArea/ViewDrawer"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0005540846, 0, -0.0042898655)
modulate = Color(1, 0, 0, 0.19607843)
pixel_size = 0.02
axis = 1
double_sided = false
texture = SubResource("ViewportTexture_2steh")
metadata/_edit_lock_ = true

[node name="SubViewport" type="SubViewport" parent="DetectionArea/ViewDrawer/Sprite3D"]
transparent_bg = true
size = Vector2i(500, 500)

[node name="Polygon2D" type="Polygon2D" parent="DetectionArea/ViewDrawer/Sprite3D/SubViewport"]
polygon = PackedVector2Array(0, 0, 176.7767, -176.7767, 184.31934, -168.89754, 191.51111, -160.69688, 198.33833, -152.19035, 204.78802, -143.39412, 210.84785, -134.3249, 216.50633, -125, 221.75269, -115.43715, 226.57695, -105.65457, 230.96988, -95.67087, 234.92314, -85.505035, 238.42923, -75.176445, 241.48145, -64.704765, 244.074, -54.10991, 246.20195, -43.412045, 247.86122, -32.63155, 249.04869, -21.788935, 249.76205, -10.904847, 250, 0, 249.76205, 10.904847, 249.04869, 21.788935, 247.86122, 32.63155, 246.20195, 43.412045, 244.074, 54.10991, 241.48145, 64.704765, 238.42923, 75.176445, 234.92314, 85.505035, 230.96988, 95.67087, 226.57695, 105.65457, 221.75269, 115.43715, 216.50633, 125, 210.84785, 134.3249, 204.78802, 143.39412, 198.33833, 152.19035, 191.51111, 160.69688, 184.31934, 168.89754, 176.7767, 176.7767)
uv = PackedVector2Array(0, 0, 84.68448, -235.2202, 124.35167, -216.87936, 160.2189, -191.9112, 191.1902, -161.07858, 216.3191, -125.323746, 234.83775, -85.73929, 246.18027, -43.534813, 250, 0, 246.18027, 43.534813, 234.83775, 85.73929, 216.3191, 125.323746, 191.1902, 161.07858, 160.2189, 191.9112, 124.35167, 216.87936, 84.68448, 235.2202)

[node name="Camera2D" type="Camera2D" parent="DetectionArea/ViewDrawer/Sprite3D/SubViewport"]

[node name="AwarenessIcon" type="Sprite3D" parent="DetectionArea"]
transform = Transform3D(-4.371139e-08, 0, 1, 0, 1, 0, -1, 0, -4.371139e-08, 0, 2, 0)
material_override = SubResource("ShaderMaterial_a7men")
pixel_size = 0.002
billboard = 1
texture = ExtResource("8_plmtm")
metadata/_edit_lock_ = true

[node name="RayCast3D" type="RayCast3D" parent="DetectionArea"]
collision_mask = 3

[node name="GuardAnimator" type="AnimationTree" parent="."]
root_node = NodePath("../guard")
tree_root = SubResource("AnimationNodeStateMachine_n2vfk")
anim_player = NodePath("../guard/AnimationPlayer")
parameters/Movement/blend_position = 0.9377193
script = ExtResource("5_nw0ie")

[node name="DoorRaycast" type="RayCast3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
target_position = Vector3(0, 0, 1)
collision_mask = 8
collide_with_areas = true
collide_with_bodies = false

[editable path="guard"]
